# 🚀 OneDayPillo API 개발 계획서

## 📋 개요

OneDayPillo Flutter 앱에서 REST API를 활용한 백엔드 시스템으로의 마이그레이션을 위한 종합적인 개발 계획서입니다.

### 🎯 목표
- REST API 기반 시스템으로 완전 전환 (Supabase 클라이언트 제거)
- 표준화된 API 클라이언트 아키텍처 구축
- 확장 가능하고 유지보수 가능한 코드베이스 구현
- 사용자 경험 개선 및 성능 최적화

### 🛠️ 기술 스택
- **Flutter**: 크로스 플랫폼 모바일 개발
- **Dio**: HTTP 클라이언트 라이브러리
- **Riverpod**: 상태 관리
- **Repository Pattern**: 데이터 레이어 추상화
- **JWT**: 인증 토큰 관리
- **Secure Storage**: 민감한 데이터 보안 저장

## 🏗️ 아키텍처 설계

### 1. 레이어 구조
```
📱 Presentation Layer (UI/Widgets)
    ↓
🎯 Business Logic Layer (Providers/Notifiers)
    ↓
📊 Data Layer (Repositories)
    ↓
🌐 Network Layer (API Clients)
    ↓
💾 Storage Layer (Local/Remote)
```

### 2. 핵심 컴포넌트
- **API Client**: HTTP 통신 및 JWT 토큰 관리
- **Repository**: 데이터 소스 추상화 (API/Local)
- **Service**: 비즈니스 로직 처리
- **Model**: 데이터 모델 및 변환
- **Interceptor**: 요청/응답 처리 및 에러 핸들링

## 📅 개발 일정 및 Phase

### Phase 1: 기반 구조 구축 (Week 1)
**목표**: API 통신을 위한 기본 인프라 구축

#### 🔧 환경 설정 관리
- [ ] `.env` 파일 구조 설계 및 구현
- [ ] Flutter 환경별 설정 클래스 개발
- [ ] API Base URL 및 키 관리 시스템
- [ ] 개발/프로덕션 환경 분리

#### 🌐 HTTP 클라이언트 구현
- [ ] Dio 기반 API 클라이언트 구축
- [ ] JWT 토큰 자동 관리 Interceptor
- [ ] 에러 핸들링 및 재시도 로직
- [ ] Request/Response 로깅 시스템
- [ ] 타임아웃 및 연결 설정

#### 📊 데이터 모델 확장
- [ ] API 응답 형식에 맞는 모델 업데이트
- [ ] JSON 직렬화/역직렬화 개선
- [ ] 에러 모델 및 상태 모델 정의
- [ ] 타입 안전성 보장

### Phase 2: 인증 시스템 구축 (Week 2)
**목표**: JWT 기반 인증 시스템 구현

#### 🔐 API 기반 인증 서비스
- [ ] 이메일/패스워드 로그인 API 연동
- [ ] 회원가입 API 연동
- [ ] JWT 토큰 관리 (Access/Refresh)
- [ ] 토큰 자동 갱신 로직
- [ ] 로그아웃 API 연동

#### 🌍 소셜 로그인 연동 (보류)
- [ ] ~~Google 로그인 API 연동~~ (보류)
- [ ] ~~Facebook 로그인 API 연동~~ (보류)
- [ ] ~~Kakao 로그인 API 연동~~ (보류)
- [ ] ~~Apple 로그인 API 연동~~ (보류)
- [ ] ~~소셜 토큰 검증 및 사용자 정보 매핑~~ (보류)
- [ ] **현재 기존 Supabase 소셜 로그인 유지**

#### 🗑️ Supabase 클라이언트 제거
- [ ] Supabase 인증 서비스 제거
- [ ] Supabase 의존성 정리
- [ ] 기존 인증 로직을 API 기반으로 완전 교체
- [ ] 인증 상태 관리 API 기반으로 전환

### Phase 3: 약물 관리 시스템 (Week 3)
**목표**: 약물 CRUD 작업을 API 기반으로 전환

#### 💊 약물 관리 API 클라이언트
- [ ] 약물 목록 조회 API
- [ ] 약물 추가 API
- [ ] 약물 수정 API
- [ ] 약물 삭제 API
- [ ] 오늘의 약물 목록 API
- [ ] 약물 활성화/비활성화 API

#### 🏛️ Repository 패턴 적용
- [ ] MedicationRepository 인터페이스 설계
- [ ] API 기반 Repository 구현체
- [ ] 로컬 캐시 Repository 구현 (오프라인 지원)
- [ ] Repository 팩토리 패턴 구현
- [ ] 의존성 주입 설정

#### 🔄 상태 관리 업데이트
- [ ] Riverpod 프로바이더를 Repository 패턴으로 변경
- [ ] API 에러 상태 처리
- [ ] 로딩 상태 관리 개선
- [ ] 캐싱 전략 구현
- [ ] 오프라인 상태 처리

### Phase 4: 복용 로그 및 고급 기능 (Week 4)
**목표**: 복용 로그, 통계, 알림 시스템 완성

#### 📝 복용 로그 시스템
- [ ] 복용 로그 기록 API
- [ ] 복용 로그 조회 API (필터링, 페이징)
- [ ] 복용 로그 수정/삭제 API
- [ ] 일별/주별/월별 통계 API
- [ ] 복용 준수율 계산 API

#### 📊 통계 및 분석
- [ ] 약물별 복용 통계
- [ ] 복용 히스토리 분석
- [ ] 트렌드 분석 및 시각화
- [ ] 개인화된 인사이트 제공

#### 🔔 알림 시스템
- [ ] 알림 설정 API
- [ ] 알림 스케줄링
- [ ] 푸시 알림 연동
- [ ] 알림 로그 및 통계

## 🔧 기술적 고려사항

### 1. 네트워크 처리
- **오프라인 상태 처리**: 로컬 캐시 활용, 재연결 시 동기화
- **네트워크 재연결**: 자동 재시도 및 백그라운드 동기화
- **로컬 캐싱**: 자주 사용되는 데이터 캐싱 전략
- **배치 요청**: 여러 API 호출 최적화

### 2. 보안
- **JWT 토큰 저장**: flutter_secure_storage 활용
- **API 키 보안**: 환경변수 및 코드 난독화
- **민감한 데이터 암호화**: 사용자 정보 보호
- **HTTPS 강제**: 모든 API 통신 암호화

### 3. 성능 최적화
- **API 응답 캐싱**: 적절한 캐시 TTL 설정
- **이미지 로딩**: 지연 로딩 및 캐싱
- **메모리 관리**: 불필요한 객체 해제
- **배터리 최적화**: 백그라운드 작업 최소화

### 4. 에러 처리
- **API 에러 코드 매핑**: 표준화된 에러 처리
- **사용자 친화적 메시지**: 기술적 에러를 사용자 언어로 변환
- **자동 재시도**: 네트워크 에러 시 자동 재시도
- **에러 로깅**: 상세한 에러 정보 수집

## 🧪 테스트 전략

### 1. 테스트 유형
- **Unit Tests**: Repository, Service Layer 테스트
- **Widget Tests**: UI 컴포넌트 테스트
- **Integration Tests**: API 연동 테스트
- **E2E Tests**: 전체 사용자 시나리오 테스트

### 2. 테스트 도구
- **flutter_test**: 기본 테스트 프레임워크
- **mockito**: API 모킹
- **integration_test**: 통합 테스트
- **golden_toolkit**: UI 스냅샷 테스트

### 3. 테스트 목표
- **코드 커버리지**: 80% 이상
- **API 응답 시간**: 2초 이내
- **메모리 누수**: 0건
- **크래시율**: 1% 이하

## 📊 품질 보증

### 1. 코드 품질
- **Clean Architecture**: 계층 분리 및 의존성 규칙
- **SOLID 원칙**: 단일 책임, 개방-폐쇄 원칙 등
- **코드 리뷰**: 모든 PR에 대한 리뷰 프로세스
- **정적 분석**: dart analyze 및 lint 규칙 준수

### 2. 문서화
- **API 사용 가이드**: 개발자를 위한 상세 가이드
- **코드 주석**: 복잡한 로직에 대한 설명
- **아키텍처 문서**: 시스템 구조 및 설계 의도
- **배포 가이드**: 환경별 배포 프로세스

### 3. 모니터링
- **API 응답 시간**: 실시간 모니터링
- **에러 로깅**: 상세한 에러 정보 수집
- **사용자 행동**: 핵심 지표 추적
- **성능 메트릭**: 앱 성능 지표 모니터링

## ✅ 성공 기준

### 1. 기능적 요구사항
- [x] 모든 API 엔드포인트 정상 연동
- [x] 기존 기능과 동일한 사용자 경험 제공
- [x] 오프라인/온라인 상태 적절한 처리
- [x] 에러 상황 사용자 친화적 처리

### 2. 비기능적 요구사항
- [ ] API 응답 시간 < 2초
- [ ] 앱 크래시율 < 1%
- [ ] 메모리 사용량 최적화
- [ ] 배터리 사용량 최적화

### 3. 사용자 경험
- [x] 로그인/로그아웃 원활한 처리
- [x] 약물 관리 즉시 반영
- [x] 복용 로그 실시간 동기화
- [x] 직관적인 에러 메시지

### 4. 개발자 경험
- [x] 코드 가독성 및 유지보수성
- [ ] 테스트 커버리지 > 80%
- [x] 완전한 문서화

## 🔄 리스크 관리

### 1. 기술적 리스크
- **API 불안정성**: Mock 서버 및 폴백 전략
- **네트워크 지연**: 적절한 타임아웃 및 재시도
- **토큰 만료**: 자동 갱신 로직
- **데이터 손실**: 백업 및 복구 계획

### 2. 일정 리스크
- **개발 지연**: 버퍼 시간 확보
- **테스트 부족**: 단계별 검증
- **통합 문제**: 조기 통합 테스트
- **배포 실패**: 롤백 계획 수립

### 3. 완화 전략
- **API 우선 개발**: 백엔드 API 먼저 구축 후 클라이언트 연동
- **단계별 전환**: 인증 → 약물관리 → 복용로그 순서로 전환
- **오프라인 지원**: 로컬 캐시로 네트워크 장애 대응
- **모니터링**: 실시간 상태 추적

## 📋 체크리스트

### Phase 1: 기반 구조 (Week 1)
- [x] 환경 설정 클래스 구현
- [x] HTTP 클라이언트 구축
- [x] JWT 토큰 관리 시스템
- [x] 기본 모델 및 에러 처리
- [x] 로깅 시스템 구축

### Phase 2: 인증 시스템 (Week 2)
- [x] 이메일/패스워드 API 연동
- [x] JWT 토큰 자동 갱신
- [ ] Supabase 클라이언트 제거
- [x] API 기반 인증 완전 전환
- [x] 기존 Supabase 소셜 로그인 유지

### Phase 3: 약물 관리 (Week 3)
- [x] Repository 패턴 적용
- [x] 약물 CRUD API 연동
- [x] 상태 관리 업데이트
- [x] 오프라인 처리
- [x] 캐싱 전략 구현

### Phase 4: 고급 기능 (Week 4)
- [x] 복용 로그 API 연동
- [x] 통계 및 분석 기능
- [x] 알림 시스템
- [x] 성능 최적화
- [ ] 테스트 완료

### 품질 보증
- [ ] Unit 테스트 작성
- [ ] Integration 테스트
- [ ] 코드 리뷰 완료
- [ ] 문서화 완료
- [ ] 성능 테스트 통과

### 배포 준비
- [ ] 환경별 설정 검증
- [ ] 보안 검토 완료
- [ ] 모니터링 설정
- [ ] 롤백 계획 수립

## 🎯 다음 단계

1. **완료된 작업**:
   - ✅ 환경 설정 클래스 구현
   - ✅ HTTP 클라이언트 기본 구조 구축
   - ✅ API 모델 정의
   - ✅ Repository 인터페이스 설계
   - ✅ 에러 처리 시스템 구축
   - ✅ 인증 시스템 구현
   - ✅ 약물 관리 시스템 구현
   - ✅ 복용 로그 및 통계 시스템 구현
   - ✅ 알림 시스템 구현

2. **남은 작업**:
   - Supabase 클라이언트 제거 (선택적)
   - 테스트 환경 설정 및 테스트 작성
   - 성능 모니터링 시스템

3. **후속 작업**:
   - 사용자 피드백 수집
   - 지속적인 최적화
   - 소셜 로그인 API 연동 (필요시)

---

*이 계획서는 OneDayPillo API 마이그레이션 프로젝트의 로드맵입니다.*
*각 Phase별로 세부 작업을 진행하며, 필요에 따라 계획을 조정할 수 있습니다.*
